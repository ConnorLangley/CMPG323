using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Data.SqlClient;
using System.Data;


namespace Login_Test_2
{
    public partial class WebForm1 : System.Web.UI.Page
    {
        // Start of conection of the data base and setting varubales to ease the use of data base manigment tools

        public SqlConnection conn;
        public SqlCommand comm;
        public DataSet ds;
        public SqlDataAdapter adap;
        public string constr = @"Server=tcp:cmpg323.database.windows.net,1433;Initial Catalog=CMPG323;Encrypt=True;TrustServerCertificate=False;Connection Timeout=30;Authentication=Active Directory Default"; //"Data Source=.;Initial Catalog=Projek;Integrated Security=True"; Data Sorce for the data base

        // End of data varuble setupp

        // Insure data base loads when the webpage is loadded by astablising and testing the conection
        protected void Page_Load(object sender, EventArgs e)
        {
            conn = new SqlConnection(constr);

            conn.Open();
            conn.Close();

        }
        // End of Page_load

        // Function for SignIn - writern in a buttion but can be implemented as a function with a litte bit of trouble shooring
        protected void btnSignIn_Click(object sender, EventArgs e)
        {
            // test if the needed information is given to run the function, Setting the name for the usser as a session to ease the uther functions
            if (txtSiName.Text == "" || txtSiPassword.Text == "")
            {
                // Display error merssaage here label used for test
            }
            else
            {
                Session["Name"] = txtSiName.Text;

                Response.Redirect("DataBase.aspx");
            }

            comm = new SqlCommand("select * from USERS where uid'" + txtSiName + "'", conn);
            SqlDataReader dr = comm.ExecuteReader();

            if (dr.Read())
            {
                //Meassage of sesesfull read
            }
            else
            {
                //Error message to show unsecsesfull read
            }

            // Move to new page since password and uisername match

        }
        // End of SignIn function

        // Function to create a account - writern in a buttion but can be implemented as a function with a litte bit of trouble shooring
        protected void btnAccCreation_Click(object sender, EventArgs e)
        {

            // test if the needed information is given to run the function, Setting the name for the usser as a session to ease the uther functions
            if (txtAcName.Text == "" || txtAcPassword.Text == "" || txtAcRePassword.Text == "" || txtAcContact.Text == "")
            {
                // Display error merssaage here label used for test
            }
            else
            {
                Session["Name"] = txtAcName.Text;
                Session["Contact"] = txtAcContact.Text;

                Response.Redirect("DataBase.aspx"); //can change depending on data base name
            }

            if (txtAcPassword.Text == txtAcRePassword.Text)
            {
                // Error message for to insure the passwords are the same
            }
            else
            {
                // Get Information ready and  insurt into database

                conn.Open();
                comm = new SqlCommand("insert into record USERS('" + txtAcName.Text + "','" + txtAcPassword.Text + "','" + txtAcContact.Text + "')", conn);
                comm.ExecuteNonQuery();
                // Set message to display secsesfull data insertion
                conn.Close();

            }

        }
        // end account creation function

        // Function to reset password - writern in a buttion but can be implemented as a function with a litte bit of trouble shooring
        protected void btnResetPassword_Click(object sender, EventArgs e)
        {
            if (txtResetNewPass.Text == "" || txtResetReEnterPass.Text == "")
            {
                // Error message to fill in needed information
            }
            else if (txtResetNewPass.Text == txtResetReEnterPass.Text)
            {

                conn.Open();

                comm = new SqlCommand("update USERS set password '" + txtResetNewPass.Text + "'where Usermane'" + txtresetUserName + "'`", conn);
                comm.ExecuteNonQuery();

                conn.Close();

                // Changed succsesfully message
            }
            else
            {
                // Error message passwords do not match
            }           
        }
        // End of password reset function


        // Ceak if username and contact information match
        protected void btnResetCheak_Click(object sender, EventArgs e)
        {
            conn.Open();

            comm = new SqlCommand("select * from USERS where Username'" + txtresetUserName + "'", conn);
            SqlDataReader dr = comm.ExecuteReader();

            if (dr.Read())
            {
                //Meassage of sesesfull read
            }
            else
            {
                //Error message to show unsecsesfull read
            }

            dr.Close();
            conn.Close();
        }
        // end of ceak

    }
}
